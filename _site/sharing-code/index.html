<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Bedrock - Sharing Code</title>
    <meta name="description" content="A minimalist boilerplate for Express apps.">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css">
    <!--<![endif]-->
    <link rel="stylesheet" href="/bedrock/css/side-menu.css">
    <link rel="stylesheet" href="/bedrock/css/bedrock.css">
    <link rel="canonical" href="http://tilomitra.github.io/bedrock/sharing-code/">
    <script type="text/javascript" src="//use.typekit.net/eeu1jcy.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>

  <body>
    
    <div id="layout">
      
      <!-- Menu toggle -->
<a href="#menu" id="menuLink" class="menu-link">
    <!-- Hamburger icon -->
    <span></span>
</a>
<div id="menu">
    <div class="pure-menu pure-menu-open">
        <a class="pure-menu-heading" href="/bedrock">Bedrock</a>

        <ul>
            <li >
                <a href="/bedrock">Home</a>
            </li>
            <li>
                <a href="/bedrock/server/">Configuring the Server</a>
            </li>
            <li>
                <a href="/bedrock/views/">Rendering Views</a>
            </li>
            <li>
                <a href="/bedrock/helpers/">Handlebars Helpers</a>
            </li>
            <li class='pure-menu-selected' >
                <a href="/bedrock/sharing-code/">Sharing Code</a>
            </li>

            <li class="menu-item-divided">
                <a href="http://github.com/tilomitra/bedrock/">GitHub</a>
            </li>

            <li><a href="http://twitter.com/tilomitra/">Twitter</a></li>
        </ul>
    </div>
</div>

      <div id="main">
        <div class="l-wrap">
          <div class="header">
    <h1 class="header-title">Bedrock</h1>
    <h2 class="header-subtitle">A minimalist boilerplate for Express apps.</h2>
    <a href="https://heroku.com/deploy?template=https://github.com/tilomitra/bedrock">
      <img src="https://www.herokucdn.com/deploy/button.png" alt="Deploy">
    </a>
    <a class="header-button pure-button" href="http://github.com/tilomitra/bedrock">View on GitHub</a>
</div>

          <div class="content">
            <div class="l-inner">
              <h3 class="content-title">Keeping things DRY</h3>
<p>
    Using NodeJS allows you to share code between the server and the client since you're writing JavaScript on both sides. This allows you to keep your code <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>. Bedrock exercises this principle and provides ways for you to write code once, but share it between the client and the server.
</p>

<p>
    In Bedrock, the server can share the following with the client:
</p>
<ul>
    <li>Any JavaScript data (strings, numbers, objects, arrays, etc.)</li>
    <li>Precompiled Handlebars Partials</li>
</ul>

<h3 class="content-title">Sharing JavaScript data</h3>
<p>
    Bedrock leverages the excellent <a href="https://github.com/yahoo/express-state">express-state</a> npm module to expose JavaScript data to the client. By default, the data is stored on the <code>App</code> global variable on the client. This can be changed by modifying the <code>state namespace</code> in <code>server.js</code>.
</p>

<pre class="code-snippet"><code>app.set('state namespace', 'App');</code></pre>

<p>
    You can expose data for all pages in the app (app-level) or for an individual request. 
</p>

<h4 class="content-subtitle">Exposing App-level Data</h4>
<p>
    When data that needs to be exposed to the client-side JavaScript code is not request-specific and should be available to all requests, it should be exposed at the app's scope using <code>app.expose()</code>.
</p>

<h5 class="content-filename">server.js</h5>
<pre class="code-snippet"><code>
app.expose({
flickr: '02348notreal2394879137872358bla'
}, 'apiKeys');
</code></pre>

<p>
    In the example above, all pages of the app will have the API Key available at <code>App.apiKeys.flickr</code>.
</p>

<h4 class="content-subtitle">Exposing Request-level Data</h4>
<p>
    When data that needs to be exposed is specific to a certain request, it can be exposed using <code>res.expose()</code> within a route handler.
</p>

<h5 class="content-filename">server.js</h5>
<pre class="code-snippet"><code>router.get('/user/:name', function (req, res, next) {
<span class="code-comment">// Get some user data</span>
var user = getUserWithName(req.params.name);

<span class="code-comment">// Expose the data to the client under App.user</span>
res.expose(user, 'user');

<span class="code-comment">// Send the data to Handlebars, so it renders server-side as well.</span>
res.render('userPage', {user: user}); 
});
</code></pre>

<p>
    In the example above, the page will render server-side with the <code>user</code> data, but it will also be available to the client under <code>App.user</code>.
</p>

<h4 class="content-subtitle">Use cases for sharing data</h4>
<p>
    Once you get used to it, sharing data from the server to the client becomes extremely handy. Personally, I don't know how I developed without it. Sharing data allows you to do things like:
</p>
<ul>
    <li>Render a page server-side, but send data to the client to build rich client-side UIs (for example: creating a client-side datatable).</li>
    <li>Share 3rd party API Keys so you can store them in one place on the server, render data server-side, but use AJAX on the client for snappy UIs</li>
    <li>Share app-level parameters</li>
    <li>Expose CSRF tokens for requests</li>
</ul>

<h3 class="content-title">Sharing Handlebars Partials</h3>
<p>
    When building your app on Bedrock, you have the ability to write a Handlebars partial and use it on the server and the client. Any Handlebars file that you add to the <code>shared/templates/</code> directory will automatically be exposed to the client-side JavaScript via <a href="https://github.com/yahoo/express-state">express-state</a>. Let's look at an example:
</p>

<h5 class="content-filename">name.handlebars</h5>
<p>Let's assume we create a file called <code>name.handlebars</code> inside <code>shared/templates/</code></p>
<pre class="code-snippet"><code>&lt;p&gt;Hello, my name is {{name}}.&lt;/p&gt;</code></pre>

<h5 class="content-filename">myView.handlebars</h5>
<p>We can use it as a partial from the server, through the regular <code></code> syntax.</p>
<pre class="code-snippet"><code>{{> name}}
&lt;p&gt;Hello World.&lt;/p&gt;
</code></pre>

<h5 class="content-filename">script.js</h5>
<p>We can also access the partial on the client-side with JavaScript. You'll just need to pull in <a href="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.4/handlebars.min.js">Handlebars.js</a>.</p>
<pre class="code-snippet"><code>var template = Handlebars.template(App.templates.name);
var html = template({name: "Tilo"});

<span class="code-comment">//&lt;p&gt;Hello, my name is Tilo.&lt;/p&gt;</span>
console.log(html);
</code></pre>

<p>
    The templates are available inside the <code>App.templates</code> namespace, and their file names are used as the key.
</p>






            </div>
          </div>

          <div class="footer">
    <div class="l-inner">
        <div class="pure-g">
            <div class="pure-u-1-2">
                <img src="https://pbs.twimg.com/profile_images/488721474979516417/E4zV-064.png" class="footer-avatar" width="16" height="16">
                <a href="http://twitter.com/tilomitra">Made by Tilo</a>
            </div>
            <div class="pure-u-1-2 t-right">
                <span class="t-muted">Built on shoulders of giants. MIT Licensed.</span>
            </div>
        </div>
    </div>
</div>
          <script src="/bedrock/js/ui.js"></script>
        </div>
      </div>
    </div>
  </body>
</html>

---
layout: default
title: Bedrock - Configuring the Server
permalink: /server/
---

<h3 class="content-title" id="overview">Starting the Server</h3>

<h4 class="content-subtitle">Development Mode</h4>
<p>
    The file that instantiates the Express server in Bedrock is <code>server.js</code>. To start Bedrock's server, just run:
    <pre class="code-snippet"><code>npm start</code></pre>
</p>
<p>
    I recommend using a tool like <a href="https://github.com/remy/nodemon">nodemon</a> or <a href="https://github.com/isaacs/node-supervisor">node-supervisor</a> so that your server restarts anytime a file is changed.
</p>

<p>If you decide to use nodemon, you can start a self-restarting server like this:</p>

<pre class="code-snippet"><code>nodemon -e handlebars,css,js server.js</code></pre>

<h4 class="content-subtitle">Production Mode</h4>
<p>
    When deploying to production, I recomment using <a href="https://github.com/Unitech/PM2/">PM2</a> to deploy your app. PM2 has a great API to help you manage your production instances. Bedrock supports PM2's <a href="https://github.com/Unitech/PM2/blob/development/ADVANCED_README.md#json-app-declaration">JSON App Declaration</a>, so you can start a production instance of your app pretty easily:
</p>

<pre class="code-snippet"><code>pm2 start server.json</code></pre>

<p>
    You can update the <code>server.json</code> file and pass in the necessary NODE_ENV paramters that your app needs. If you decide to not use pm2, just delete that file.
</p>

<h3 class="content-title" id="features">Configuring the Server</h3>
<p>
    Bedrock's server comprises of an Express 4.x app instance and a single router. You can view and modify the default app-level settings in <code>server.js</code>. <a href="https://github.com/tilomitra/bedrock/blob/master/server.js">The file</a> is self-explanatory and comment-heavy, so I perusing through it quickly.
</p>

<h3 class="content-title" id="features">Route Handling</h3>
<p>
    Route handling works just like you would expect it to inside an Express App. You can add routes to the <code>server.js</code> file:
</p>

<pre class="code-snippet"><code>router.get('/foo', function (req, res, next) {
doSomething();
res.render('foo');
});
</code></pre>

<p>
    Bedrock has some helper methods to make route handling less verbose. The <code>routes</code> object in <code>server.js</code> exports <code>render()</code> and <code>redirect()</code> methods.
</p>

<p>
    <code>routes.render()</code> can take a <code>viewName</code> and an optional <code>layoutPath</code> and call <code>res.render()</code> under-the-hood. This lets you just do the following:
</p>

<pre class="code-snippet"><code>router.get('/foo', routes.render('foo'));</code></pre>

<p>
    <code>routes.redirect()</code> can take a <code>URL</code> and an optional <code>statusCode</code> and call <code>res.redirect()</code> under-the-hood. This lets you just do the following:
</p>

<pre class="code-snippet"><code>router.get('/foo', routes.redirect('/bar', 301));</code></pre>


<h3 class="content-title" id="features">Middleware</h3>
<p>
    Middleware can be defined inside the <code>middleware/</code> directory, and can be called inside a route handler within <code>server.js</code>. By default, Bedrock comes with Middleware to handle:
    <ul>
        <li>Logging</li>
        <li>Strict Routing</li>
        <li>Exposing Templates to the Client</li>
    </ul>
    Here's an example on how you can use middleware inside a route handler:
</p>
    <pre class="code-snippet"><code>router.get('/', [ middleware.exposeTemplates(), routes.render('home') ]);</code>    </pre>
<p>
    In the example above, all routes to <code>/</code> will go through <code>middleware.exposeTemplates</code>, which will expose Handlebars partials that are stored within the <code>shared/templates/</code> directory to the client-side JavaScript under <code>App.templates</code>. Read more about this in the <a href="../sharing-code/">Sharing Code</a> section.
</p>

<h3 class="content-title" id="features">Static Files</h3>
<p>
    Static files like images, CSS, and JS files should be stored inside the <code>public/</code> directory.
</p>

<h3 class="content-title" id="features">Cluster Support</h3>
<p>
    Cluster lets you spawn multiple instances of your app based on the number of CPUs available on the box that the app is being deployed on. It is a simple way to increase the performance of your app. Bedrock now has cluster support. If you want to enable it, go into <code>server.js</code> and do the following:
</p>

<p>Comment out this line:</p>

<pre class="code-snippet"><code>setupServer();</code></pre>
<p>And uncomment this line:</p>
<pre class="code-snippet"><code>cluster(setupServer());</code></pre>